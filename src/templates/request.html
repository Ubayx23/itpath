{% extends "base.html" %}

{% block content %}
<div class="request-detail">
    <div class="request-header-large">
        <h2>Request #{{ req.id }}</h2>
        <span class="state-badge-large state-{{ req.state }}">{{ req.state.replace('_', ' ').title() }}</span>
    </div>

    <div class="request-info">
        <p class="description">{{ req.description }}</p>
        <p class="meta">Created: {{ req.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
    </div>

    <div class="state-update">
        <h3>Update State</h3>
        <form method="POST" action="{{ url_for('update_state', request_id=req.id) }}">
            <select name="state" class="state-select">
                <option value="submitted" {% if req.state == 'submitted' %}selected{% endif %}>Submitted</option>
                <option value="in_progress" {% if req.state == 'in_progress' %}selected{% endif %}>In Progress</option>
                <option value="resolved" {% if req.state == 'resolved' %}selected{% endif %}>Resolved</option>
            </select>
            <button type="submit" class="btn-primary">Update State</button>
        </form>
    </div>

    <div class="activity-log">
        <h3>Activity Log</h3>
        {% if req.logs %}
            <ul class="log-list">
                {% for timestamp, action, details in req.logs %}
                <li class="log-entry">
                    <span class="log-time">{{ timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</span>
                    <span class="log-action">{{ action.replace('_', ' ').title() }}</span>
                    <span class="log-details">{{ details }}</span>
                </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No activity logged yet.</p>
        {% endif %}
    </div>

    <div class="back-link">
        <a href="{{ url_for('index') }}">‚Üê Back to All Requests</a>
    </div>
</div>
{% endblock %}

